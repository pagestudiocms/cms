var encodeURL,show_animation,hide_animation,apply,apply_none,apply_img,apply_any,apply_video,apply_link,apply_file_rename,apply_file_duplicate,apply_folder_rename;!function(a,b,c){"use strict";function d(b){show_animation();var c=new Image;c.src=b,a(c).on("load",function(){hide_animation()})}function e(){a("#textfile_create_area").parent().parent().remove();var b=a("#lang_filename").val()+': <input type="text" id="create_text_file_name" style="min-height:30px"><br><hr><textarea id="textfile_create_area" style="width:100%;height:150px;"></textarea>';bootbox.dialog(b,[{label:a("#cancel").val(),class:"btn"},{label:a("#ok").val(),class:"btn-inverse",callback:function(){var b=a("#create_text_file_name").val(),c=a("#textfile_create_area").val();if(null!==b){b=u(b);var d=a("#sub_folder").val()+a("#fldr_value").val();a.ajax({type:"POST",url:"execute.php?action=create_file",data:{path:d,name:b,new_content:c}}).done(function(b){""!=b&&bootbox.alert(b,function(){setTimeout(function(){window.location.href=a("#refresh").attr("href")+"&"+(new Date).getTime()},500)})})}}}],{header:a("#lang_new_file").val()})}function f(b){a("#textfile_edit_area").parent().parent().remove();var c=b.find(".rename-file-paths").attr("data-path");a.ajax({type:"POST",url:"ajax_calls.php?action=get_file&sub_action=edit&preview_mode=text",data:{path:c}}).done(function(d){bootbox.dialog(d,[{label:a("#cancel").val(),class:"btn"},{label:a("#ok").val(),class:"btn-inverse",callback:function(){var b=a("#textfile_edit_area").val();a.ajax({type:"POST",url:"execute.php?action=save_text_file",data:{path:c,new_content:b}}).done(function(a){""!=a&&bootbox.alert(a)})}}],{header:b.find(".name_download").val()})})}function g(){a.ajax({type:"POST",url:"ajax_calls.php?action=get_lang",data:{}}).done(function(b){bootbox.dialog(b,[{label:a("#cancel").val(),class:"btn"},{label:a("#ok").val(),class:"btn-inverse",callback:function(){var b=a("#new_lang_select").val();a.ajax({type:"POST",url:"ajax_calls.php?action=change_lang",data:{choosen_lang:b}}).done(function(b){""!=b?bootbox.alert(b):setTimeout(function(){window.location.href=a("#refresh").attr("href")+"&"+(new Date).getTime()},500)})}}],{header:a("#lang_lang_change").val()})})}function h(b){a("#files_permission_start").parent().parent().remove();var c;c=b.find(".rename-file-paths").attr((b.hasClass("directory"),"data-path")),a.ajax({type:"POST",url:"ajax_calls.php?action=chmod",data:{path:c}}).done(function(b){bootbox.dialog(b,[{label:a("#cancel").val(),class:"btn"},{label:a("#ok").val(),class:"btn-inverse",callback:function(){var b=a("#chmod_form #chmod_value").val();if(""!=b&&"undefined"!=typeof b){var d=a("#chmod_form input[name=apply_recursive]:checked").val();(""==d||"undefined"==typeof d)&&(d="none"),a.ajax({type:"POST",url:"execute.php?action=chmod",data:{path:c,new_mode:b,is_recursive:d}}).done(function(a){""!=a&&bootbox.alert(a)})}}}],{header:a("#lang_file_permission").val()})})}function i(b){var c=[];if(c.user=0,c.group=0,c.all=0,"undefined"!=typeof b&&1==b){var d=a("#chmod_form #chmod_value").val();c.user=d.substr(0,1),c.group=d.substr(1,1),c.all=d.substr(2,1),a.each(c,function(b){(""==c[b]||0==a.isNumeric(c[b])||parseInt(c[b])<0||parseInt(c[b])>7)&&(c[b]="0")}),a("#chmod_form input:checkbox").each(function(){var b=a(this).attr("data-group"),d=a(this).attr("data-value");j(c[b],d)?a(this).prop("checked",!0):a(this).prop("checked",!1)})}else a("#chmod_form input:checkbox:checked").each(function(){var b=a(this).attr("data-group"),d=a(this).attr("data-value");c[b]=parseInt(c[b])+parseInt(d)}),a("#chmod_form #chmod_value").val(c.user.toString()+c.group.toString()+c.all.toString())}function j(b,c){var d=[];return d[1]=[1,3,5,7],d[2]=[2,3,6,7],d[4]=[4,5,6,7],b=parseInt(b),c=parseInt(c),-1!=a.inArray(b,d[c])}function k(){bootbox.confirm(a("#lang_clear_clipboard_confirm").val(),a("#cancel").val(),a("#ok").val(),function(b){1==b&&a.ajax({type:"POST",url:"ajax_calls.php?action=clear_clipboard",data:{}}).done(function(b){""!=b?bootbox.alert(b):a("#clipboard").val("0"),o(!1)})})}function l(b,c){if("copy"==c||"cut"==c){var d;d=b.find(".rename-file-paths").attr((b.hasClass("directory"),"data-path")),a.ajax({type:"POST",url:"ajax_calls.php?action=copy_cut",data:{path:d,sub_action:c}}).done(function(b){""!=b?bootbox.alert(b):(a("#clipboard").val("1"),o(!0))})}}function m(b){bootbox.confirm(a("#lang_paste_confirm").val(),a("#cancel").val(),a("#ok").val(),function(c){if(1==c){var d;d="undefined"!=typeof b?b.find(".rename-folder").attr("data-path"):a("#sub_folder").val()+a("#fldr_value").val(),a.ajax({type:"POST",url:"execute.php?action=paste_clipboard",data:{path:d}}).done(function(b){""!=b?bootbox.alert(b):(a("#clipboard").val("0"),o(!1),setTimeout(function(){window.location.href=a("#refresh").attr("href")+"&"+(new Date).getTime()},300))})}})}function n(b,c){var d;d=b.find(b.hasClass("directory")?".rename-folder":".rename-file");var e=d.attr("data-path");b.parent().hide(100),a.ajax({type:"POST",url:"ajax_calls.php?action=copy_cut",data:{path:e,sub_action:"cut"}}).done(function(d){if(""!=d)bootbox.alert(d);else{var e;e="undefined"!=typeof c?c.hasClass("back-directory")?c.find(".path").val():c.find(".rename-folder").attr("data-path"):a("#sub_folder").val()+a("#fldr_value").val(),a.ajax({type:"POST",url:"execute.php?action=paste_clipboard",data:{path:e}}).done(function(c){""!=c?(bootbox.alert(c),b.parent().show(100)):(a("#clipboard").val("0"),o(!1),b.parent().remove())})}}).error(function(){b.parent().show(100)})}function o(b){1==b?a(".paste-here-btn, .clear-clipboard-btn").removeClass("disabled"):a(".paste-here-btn, .clear-clipboard-btn").addClass("disabled")}function p(c){var d=a(".breadcrumb").width()+c,e=a("#view"),f=a("#help");if(a(".uploader").css("width",d),e.val()>0){if(1==e.val())a("ul.grid li, ul.grid figure").css("width","100%");else{var g=Math.floor(d/380);0==g&&(g=1,a("h4").css("font-size",12)),d=Math.floor(d/g-3),a("ul.grid li, ul.grid figure").css("width",d)}f.hide()}else b.touch&&f.show()}function q(){var b=a(this);0==a("#view").val()&&(1==b.attr("toggle")?(b.attr("toggle",0),b.animate({top:"0px"},{queue:!1,duration:300})):(b.attr("toggle",1),b.animate({top:"-30px"},{queue:!1,duration:300})))}function r(a){var b=new RegExp("(?:[?&]|&)"+a+"=([^&]+)","i"),c=window.location.search.match(b);return c&&c.length>1?c[1]:null}function s(){1==a("#popup").val()?window.close():("function"==typeof parent.$(".modal").modal&&parent.$(".modal").modal("hide"),"undefined"!=typeof parent.jQuery&&parent.jQuery?"function"==typeof parent.jQuery.fancybox&&parent.jQuery.fancybox.close():"function"==typeof parent.$.fancybox&&parent.$.fancybox.close())}function t(a){for(var a,b=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],c=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"],d=0;d<b.length;d++)a=a.replace(b[d],c[d]);return a}function u(b){return null!=b?("true"==a("#transliteration").val()&&(b=t(b),b=b.replace(/[^A-Za-z0-9\.\-\[\] _]+/g,"")),"true"==a("#convert_spaces").val()&&(b=b.replace(/ /g,a("#replace_with").val())),"true"==a("#lower_case").val()&&(b=b.toLowerCase()),b=b.replace('"',""),b=b.replace("'",""),b=b.replace("/",""),b=b.replace("\\",""),b=b.replace(/<\/?[^>]+(>|$)/g,""),a.trim(b)):null}function v(b,c,d,e,f){null!==d&&(d=u(d),a.ajax({type:"POST",url:"execute.php?action="+b,data:{path:c,name:d.replace("/","")}}).done(function(a){return""!=a?(bootbox.alert(a),!1):(""!=f&&window[f](e,d),!0)}))}function w(b,c){var d=a("li.dir","ul.grid").filter(":visible"),e=a("li.file","ul.grid").filter(":visible"),f=[],g=[],h=[],i=[];d.each(function(){var b=a(this),d=b.find(c).val();if(a.isNumeric(d))for(d=parseFloat(d);"undefined"!=typeof f[d]&&f[d];)d=parseFloat(parseFloat(d)+parseFloat(.001));else d=d+"a"+b.find("h4 a").attr("data-file");f[d]=b.html(),g.push(d)}),e.each(function(){var b=a(this),d=b.find(c).val();if(a.isNumeric(d))for(d=parseFloat(d);"undefined"!=typeof h[d]&&h[d];)d=parseFloat(parseFloat(d)+parseFloat(.001));else d=d+"a"+b.find("h4 a").attr("data-file");h[d]=b.html(),i.push(d)}),a.isNumeric(g[0])?g.sort(function(a,b){return parseFloat(a)-parseFloat(b)}):g.sort(),a.isNumeric(i[0])?i.sort(function(a,b){return parseFloat(a)-parseFloat(b)}):i.sort(),b&&(g.reverse(),i.reverse()),d.each(function(b){var c=a(this);c.html(f[g[b]])}),e.each(function(b){var c=a(this);c.html(h[i[b]])})}function x(a,b){return featherEditor.launch({image:a,url:b}),!1}function y(){a(".lazy-loaded").lazyload()}var z="9.10.2",A=!0,B=0,C=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}(),D=function(b){var c=a("#base_url").val()+a("#cur_dir").val(),d=b.find("a.link").attr("data-file");return""!=d&&null!=d&&(c+=d),d=b.find("h4 a.folder-link").attr("data-file"),""!=d&&null!=d&&(c+=d),c},E={contextActions:{copy_url:function(b){var c=D(b);bootbox.alert('URL:<br/><div class="input-append" style="width:100%"><input id="url_text'+B+'" type="text" style="width:80%; height:30px;" value="'+encodeURL(c)+'" /><button id="copy-button'+B+'" class="btn btn-inverse copy-button" style="width:20%; height:30px;" data-clipboard-target="url_text'+B+'" data-clipboard-text="Copy Me!" title="copy"></button></div>'),a("#copy-button"+B).html('<i class="icon icon-white icon-share"></i> '+a("#lang_copy").val());var d=new ZeroClipboard(a("#copy-button"+B));d.on("ready",function(b){d.on("wrongFlash noFlash",function(){ZeroClipboard.destroy()}),d.on("aftercopy",function(b){a("#copy-button"+B).html('<i class="icon icon-ok"></i> '+a("#ok").val()),a("#copy-button"+B).attr("class","btn disabled"),B++}),d.on("error",function(a){})})},unzip:function(b){var c=a("#sub_folder").val()+a("#fldr_value").val()+b.find("a.link").attr("data-file");a.ajax({type:"POST",url:"ajax_calls.php?action=extract",data:{path:c}}).done(function(b){""!=b?bootbox.alert(b):window.location.href=a("#refresh").attr("href")+"&"+(new Date).getTime()})},edit_img:function(b){var c=b.attr("data-name"),d=a("#base_url").val()+a("#cur_dir").val()+c,e=a("#aviary_img");e.attr("data-name",c),show_animation(),e.attr("src",d).load(x(e.attr("id"),d))},duplicate:function(b){var c=b.find("h4").text().trim();bootbox.prompt(a("#lang_duplicate").val(),a("#cancel").val(),a("#ok").val(),function(a){if(null!==a&&(a=u(a),a!=c)){var d=b.find(".rename-file");v("duplicate_file",d.attr("data-path"),a,d,"apply_file_duplicate")}},c)},select:function(b){var c,d=D(b),e=a("#field_id").val(),f=a("#return_relative_url").val();if(1==f&&(d=d.replace(a("#base_url").val(),"")),c=1==a("#popup").val()?window.opener:window.parent,""!=e)if(1==a("#crossdomain").val())c.postMessage({sender:"responsivefilemanager",url:d,field_id:e},"*");else{var g=a("#"+e,c.document);g.val(d).trigger("change"),"function"==typeof c.responsive_filemanager_callback&&c.responsive_filemanager_callback(e),s()}else apply_any(d)},copy:function(a){l(a,"copy")},cut:function(a){l(a,"cut")},paste:function(){m()},chmod:function(a){h(a)},edit_text_file:function(a){f(a)}},makeContextMenu:function(){var b=this;a.contextMenu({selector:"figure:not(.back-directory), .list-view2 figure:not(.back-directory)",autoHide:!0,build:function(d){d.addClass("selected");var e={callback:function(a,c){b.contextActions[a](d)},items:{}};return(d.find(".img-precontainer-mini .filetype").hasClass("png")||d.find(".img-precontainer-mini .filetype").hasClass("jpg")||d.find(".img-precontainer-mini .filetype").hasClass("jpeg"))&&c&&(e.items.edit_img={name:a("#lang_edit_image").val(),icon:"edit_img",disabled:!1}),d.hasClass("directory")&&0!=a("#type_param").val()&&(e.items.select={name:a("#lang_select").val(),icon:"",disabled:!1}),e.items.copy_url={name:a("#lang_show_url").val(),icon:"url",disabled:!1},(d.find(".img-precontainer-mini .filetype").hasClass("zip")||d.find(".img-precontainer-mini .filetype").hasClass("tar")||d.find(".img-precontainer-mini .filetype").hasClass("gz"))&&(e.items.unzip={name:a("#lang_extract").val(),icon:"extract",disabled:!1}),d.find(".img-precontainer-mini .filetype").hasClass("edit-text-file-allowed")&&(e.items.edit_text_file={name:a("#lang_edit_file").val(),icon:"edit",disabled:!1}),d.hasClass("directory")||1!=a("#duplicate").val()||(e.items.duplicate={name:a("#lang_duplicate").val(),icon:"duplicate",disabled:!1}),d.hasClass("directory")||1!=a("#copy_cut_files_allowed").val()?d.hasClass("directory")&&1==a("#copy_cut_dirs_allowed").val()&&(e.items.copy={name:a("#lang_copy").val(),icon:"copy",disabled:!1},e.items.cut={name:a("#lang_cut").val(),icon:"cut",disabled:!1}):(e.items.copy={name:a("#lang_copy").val(),icon:"copy",disabled:!1},e.items.cut={name:a("#lang_cut").val(),icon:"cut",disabled:!1}),0==a("#clipboard").val()||d.hasClass("directory")||(e.items.paste={name:a("#lang_paste_here").val(),icon:"clipboard-apply",disabled:!1}),d.hasClass("directory")||1!=a("#chmod_files_allowed").val()?d.hasClass("directory")&&1==a("#chmod_dirs_allowed").val()&&(e.items.chmod={name:a("#lang_file_permission").val(),icon:"key",disabled:!1}):e.items.chmod={name:a("#lang_file_permission").val(),icon:"key",disabled:!1},e.items.sep="----",e.items.info={name:"<strong>"+a("#lang_file_info").val()+"</strong>",disabled:!0},e.items.name={name:d.attr("data-name"),icon:"label",disabled:!0},"img"==d.attr("data-type")&&(e.items.dimension={name:d.find(".img-dimension").html(),icon:"dimension",disabled:!0}),("true"===a("#show_folder_size").val()||"true"===a("#show_folder_size").val())&&(e.items.size=d.hasClass("directory")?{name:d.find(".file-size").html()+" - "+d.find(".nfiles").val()+" "+a("#lang_files").val()+" - "+d.find(".nfolders").val()+" "+a("#lang_folders").val(),icon:"size",disabled:!0}:{name:d.find(".file-size").html(),icon:"size",disabled:!0}),e.items.date={name:d.find(".file-date").html(),icon:"date",disabled:!0},e},events:{hide:function(){a("figure").removeClass("selected")}}}),a(document).on("contextmenu",function(b){return!!a(b.target).is("figure")&&void 0})},bindGridEvents:function(){function b(b){window[b.attr("data-function")](b.attr("data-file"),a("#field_id").val())}var c=a("ul.grid");c.on("click",".modalAV",function(b){var c=a(this);b.preventDefault();var d=a("#previewAV"),e=a(".body-preview");d.removeData("modal"),d.modal({backdrop:"static",keyboard:!1}),c.hasClass("audio")?e.css("height","80px"):e.css("height","345px"),a.ajax({url:c.attr("data-url"),success:function(a){e.html(a)}})}),c.on("click",".file-preview-btn",function(b){var c=a(this);b.preventDefault(),a.ajax({url:c.attr("data-url"),success:function(a){bootbox.modal(a," "+c.parent().parent().parent().find(".name").val())}})}),c.on("click",".preview",function(){var b=a(this);return 0==b.hasClass("disabled")&&a("#full-img").attr("src",decodeURIComponent(b.attr("data-url"))),!0}),c.on("click",".rename-file",function(){var b=a(this),c=b.parent().parent().parent(),d=c.find("h4"),e=a.trim(d.text());bootbox.prompt(a("#rename").val(),a("#cancel").val(),a("#ok").val(),function(a){null!==a&&(a=u(a),a!=e&&v("rename_file",b.attr("data-path"),a,c,"apply_file_rename"))},e)}),c.on("click",".rename-folder",function(){var b=a(this),c=b.parent().parent().parent(),d=c.find("h4"),e=a.trim(d.text());bootbox.prompt(a("#rename").val(),a("#cancel").val(),a("#ok").val(),function(a){null!==a&&(a=u(a).replace(".",""),a!=e&&v("rename_folder",b.attr("data-path"),a,c,"apply_folder_rename"))},e)}),c.on("click",".delete-file",function(){var b=a(this);bootbox.confirm(b.attr("data-confirm"),a("#cancel").val(),a("#ok").val(),function(c){if(1==c){v("delete_file",b.attr("data-path"),"","","");var d=a("#files_number");d.text(parseInt(d.text())-1),b.parent().parent().parent().parent().remove()}})}),c.on("click",".delete-folder",function(){var b=a(this);bootbox.confirm(b.attr("data-confirm"),a("#cancel").val(),a("#ok").val(),function(c){if(1==c){v("delete_folder",b.attr("data-path"),"","","");var d=a("#folders_number");d.text(parseInt(d.text())-1),b.parent().parent().parent().remove()}})}),a("ul.grid").on("click",".link",function(){b(a(this))}),a("ul.grid").on("click","div.box",function(c){var d=a(this).find(".link");if(0!==d.length)b(d);else{var e=a(this).find(".folder-link");0!==e.length&&(document.location=a(e).prop("href"))}})},makeFilters:function(b){a("#filter-input").on("keyup",function(){a(".filters label").removeClass("btn-inverse"),a(".filters label").find("i").removeClass("icon-white"),a("#ff-item-type-all").addClass("btn-inverse"),a("#ff-item-type-all").find("i").addClass("icon-white");var c=u(a(this).val()).toLowerCase();a(this).val(c),b&&C(function(){a("li","ul.grid ").each(function(){var b=a(this);""!=c&&-1==b.attr("data-name").toLowerCase().indexOf(c)?b.hide(100):b.show(100)}),a.ajax({url:"ajax_calls.php?action=filter&type="+c}).done(function(a){""!=a&&bootbox.alert(a)}),C(function(){var b=0!=a("#descending").val();w(b,"."+a("#sort_by").val()),y()},500)},300)}).keypress(function(b){13==b.which&&a("#filter").trigger("click")}),a("#filter").on("click",function(){var b=u(a("#filter-input").val());window.location.href=a("#current_url").val()+"&filter="+b})},makeUploader:function(){a("#uploader-btn").on("click",function(){var b=a("#sub_folder").val()+a("#fldr_value").val()+"/";b=b.substring(0,b.length-1),a("#iframe-container").html(a("<iframe />",{name:"JUpload",id:"uploader_frame",src:"uploader/index.php?path="+b,frameborder:0,width:"100%",height:360}))}),a(".upload-btn").on("click",function(){a(".uploader").show(500)}),a(".close-uploader").on("click",function(){a(".uploader").hide(500),setTimeout(function(){window.location.href=a("#refresh").attr("href")+"&"+(new Date).getTime()},420)})},makeSort:function(b){a("input[name=radio-sort]").on("click",function(){var d=a(this).attr("data-item"),e=a("#"+d),f=a(".filters label");f.removeClass("btn-inverse"),f.find("i").removeClass("icon-white"),a("#filter-input").val(""),e.addClass("btn-inverse"),e.find("i").addClass("icon-white"),"ff-item-type-all"==d?(b?a(".grid li").show(300):window.location.href=a("#current_url").val()+"&sort_by="+a("#sort_by").val()+"&descending="+(c?1:0),"undefined"!=typeof Storage&&localStorage.setItem("sort","")):a(this).is(":checked")&&(a(".grid li").not("."+d).hide(300),a(".grid li."+d).show(300),"undefined"!=typeof Storage&&localStorage.setItem("sort",d)),y()});var c=a("#descending").val();a(".sorter").on("click",function(){var d=a(this);c=a("#sort_by").val()!==d.attr("data-sort")||0==c,b?(a.ajax({url:"ajax_calls.php?action=sort&sort_by="+d.attr("data-sort")+"&descending="+(c?1:0)}),w(c,"."+d.attr("data-sort")),a(" a.sorter").removeClass("descending").removeClass("ascending"),a(".sort-"+d.attr("data-sort")).addClass(c?"descending":"ascending"),a("#sort_by").val(d.attr("data-sort")),a("#descending").val(c?1:0),y()):window.location.href=a("#current_url").val()+"&sort_by="+d.attr("data-sort")+"&descending="+(c?1:0)})}};a(document).ready(function(){if(a("#rfmDropzone").on("click",".dz-success .dz-detail",function(){var b=a(this);alert(b.find(".dz-filename span").tex())}),A&&E.makeContextMenu(),"undefined"!=typeof Storage){var c=localStorage.getItem("sort");if(c){var f=a("#"+c);f.addClass("btn-inverse"),f.find("i").addClass("icon-white"),a(".grid li").not("."+c).hide(300),a(".grid li."+c).show(300)}}if(a("#full-img").on("click",function(){a("#previewLightbox").lightbox("hide")}),a("body").on("click",function(){a(".tip-right").tooltip("hide")}),E.bindGridEvents(),parseInt(a("#file_number").val())>parseInt(a("#file_number_limit_js").val()))var h=!1;else var h=!0;if(E.makeSort(h),E.makeFilters(h),a("#info").on("click",function(){bootbox.alert('<div class="text-center"><br/><img src="img/logo.png" alt="responsive filemanager"/><br/><br/><p><strong>RESPONSIVE filemanager v.'+z+'</strong><br/><a href="http://www.responsivefilemanager.com">responsivefilemanager.com</a></p><br/><p>Copyright © <a href="http://www.tecrail.com" alt="tecrail">Tecrail</a> - Alberto Peripolli. All rights reserved.</p><br/><p>License<br/><small><img alt="Creative Commons License" style="border-width:0" src="http://responsivefilemanager.com/license.php" /><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</small></p></div>')}),a("#change_lang_btn").on("click",function(){g()}),E.makeUploader(),a("body").on("keypress",function(a){var b=String.fromCharCode(a.which);return"'"!=b&&'"'!=b&&"\\"!=b&&"/"!=b&&void 0}),a("ul.grid li figcaption").on("click",'a[data-toggle="lightbox"]',function(){d(decodeURIComponent(a(this).attr("data-url")))}),a(".create-file-btn").on("click",function(){e()}),a(".new-folder").on("click",function(){bootbox.prompt(a("#insert_folder_name").val(),a("#cancel").val(),a("#ok").val(),function(b){if(null!==b){b=u(b).replace(".","");var c=a("#sub_folder").val()+a("#fldr_value").val();a.ajax({type:"POST",url:"execute.php?action=create_folder",data:{path:c,name:b}}).done(function(b){setTimeout(function(){window.location.href=a("#refresh").attr("href")+"&"+(new Date).getTime()},300)})}})}),a(".view-controller button").on("click",function(){var b=a(this);a(".view-controller button").removeClass("btn-inverse"),a(".view-controller i").removeClass("icon-white"),b.addClass("btn-inverse"),b.find("i").addClass("icon-white"),a.ajax({url:"ajax_calls.php?action=view&type="+b.attr("data-value")}).done(function(a){""!=a&&bootbox.alert(a)}),"undefined"!=typeof a("ul.grid")[0]&&a("ul.grid")[0]&&(a("ul.grid")[0].className=a("ul.grid")[0].className.replace(/\blist-view.*?\b/g,"")),"undefined"!=typeof a(".sorter-container")[0]&&a(".sorter-container")[0]&&(a(".sorter-container")[0].className=a(".sorter-container")[0].className.replace(/\blist-view.*?\b/g,""));var c=b.attr("data-value");a("#view").val(c),a("ul.grid").addClass("list-view"+c),a(".sorter-container").addClass("list-view"+c),b.attr("data-value")>=1?p(14):(a("ul.grid li").css("width",126),a("ul.grid figure").css("width",122)),y()}),b.touch?(a("#help").show(),a(".box:not(.no-effect)").swipe({swipeLeft:q,swipeRight:q,threshold:30})):(a(".tip").tooltip({placement:"bottom"}),a(".tip-top").tooltip({placement:"top"}),a(".tip-left").tooltip({placement:"left"}),a(".tip-right").tooltip({placement:"right"}),a("body").addClass("no-touch")),a(".paste-here-btn").on("click",function(){0==a(this).hasClass("disabled")&&m()}),a(".clear-clipboard-btn").on("click",function(){0==a(this).hasClass("disabled")&&k()}),!b.csstransforms){var j=a("figure");j.on("mouseover",function(){0==a("#view").val()&&a("#main-item-container").hasClass("no-effect-slide")===!1&&a(this).find(".box:not(.no-effect)").animate({top:"-26px"},{queue:!1,duration:300})}),j.on("mouseout",function(){0==a("#view").val()&&a(this).find(".box:not(.no-effect)").animate({top:"0px"},{queue:!1,duration:300})})}a(window).resize(function(){p(28)}),p(14),o(1==a("#clipboard").val()),a("li.dir, li.file").draggable({distance:20,cursor:"move",helper:function(){a(this).find("figure").find(".box").css("top","0px");var b=a(this).clone().css("z-index",1e3).find(".box").css("box-shadow","none").css("-webkit-box-shadow","none").parent().parent();return a(this).addClass("selected"),b},start:function(){0==a("#view").val()&&a("#main-item-container").addClass("no-effect-slide")},stop:function(){a(this).removeClass("selected"),0==a("#view").val()&&a("#main-item-container").removeClass("no-effect-slide")}}),a("li.dir,li.back").droppable({accept:"ul.grid li",activeClass:"ui-state-highlight",hoverClass:"ui-state-hover",drop:function(b,c){n(c.draggable.find("figure"),a(this).find("figure"))}}),a(document).on("keyup","#chmod_form #chmod_value",function(){i(!0)}),a(document).on("change","#chmod_form input",function(){i(!1)}),a(document).on("focusout","#chmod_form #chmod_value",function(){var b=a("#chmod_form #chmod_value");null==b.val().match(/^[0-7]{3}$/)&&(b.val(b.attr("data-def-value")),i(!0))})}),encodeURL=function(a){for(var b=a.split("/"),c=3;c<b.length;c++)b[c]=encodeURIComponent(b[c]);return b.join("/")},apply=function(b,c){var d;d=1==a("#popup").val()?window.opener:window.parent;var e=a("#cur_dir").val(),f=(a("#subdir").val(),a("#base_url").val()),g=b.substr(0,b.lastIndexOf(".")),h=b.split(".").pop();h=h.toLowerCase();var i="",j=["ogg","mp3","wav"],k=["mp4","ogg","webm"],l=a("#return_relative_url").val(),m=encodeURL((1==l?e:f+e)+b);if(""!=c)if(1==a("#crossdomain").val())d.postMessage({sender:"responsivefilemanager",url:m,field_id:c},"*");else{var n=a("#"+c,d.document);n.val(m).trigger("change"),"function"==typeof d.responsive_filemanager_callback&&d.responsive_filemanager_callback(c),s()}else a.inArray(h,ext_img)>-1?(m=m+"?"+(new Date).getTime(),i='<img src="'+m+'" alt="'+g+'" />'):a.inArray(h,k)>-1?i='<video controls source src="'+m+'" type="video/'+h+'">'+g+"</video>":a.inArray(h,j)>-1?("mp3"==h&&(h="mpeg"),i='<audio controls src="'+m+'" type="audio/'+h+'">'+g+"</audio>"):i='<a href="'+m+'" title="'+g+'">'+g+"</a>",1==a("#crossdomain").val()?d.postMessage({sender:"responsivefilemanager",url:m,field_id:null,html:i},"*"):parent.tinymce.majorVersion<4?(parent.tinymce.activeEditor.execCommand("mceInsertContent",!1,i),parent.tinymce.activeEditor.windowManager.close(parent.tinymce.activeEditor.windowManager.params.mce_window_id)):(parent.tinymce.activeEditor.insertContent(i),parent.tinymce.activeEditor.windowManager.close())},apply_link=function(b,c){if(1==a("#popup").val())var d=window.opener;else var d=window.parent;var e=a("#cur_dir").val();e=e.replace("\\","/");var f=a("#subdir").val();f=f.replace("\\","/");var g=a("#base_url").val(),h=a("#return_relative_url").val(),i=encodeURL((1==h?e:g+e)+b);if(""!=c)if(1==a("#crossdomain").val())d.postMessage({sender:"responsivefilemanager",url:i,field_id:c},"*");else{var j=a("#"+c,d.document);j.val(i).trigger("change"),"function"==typeof d.responsive_filemanager_callback&&d.responsive_filemanager_callback(c),s()}else apply_any(i)},apply_img=function(b,c){var d;d=1==a("#popup").val()?window.opener:window.parent;var e=a("#cur_dir").val();e=e.replace("\\","/");var f=a("#subdir").val();f=f.replace("\\","/");var g=a("#website_url").val()+"/",h=a("#return_relative_url").val(),i=encodeURL((1==h?e:g+e)+b);if(""!=c)if(1==a("#crossdomain").val())d.postMessage({sender:"responsivefilemanager",url:i,field_id:c},"*");else{var j=a("#"+c,d.document);j.attr("src",i).trigger("change"),"function"==typeof d.responsive_filemanager_callback&&d.responsive_filemanager_callback(c),s()}else i=i+"?"+(new Date).getTime(),apply_any(i)},apply_video=function(b,c){var d;d=1==a("#popup").val()?window.opener:window.parent;var e=a("#cur_dir").val();e=e.replace("\\","/");var f=a("#subdir").val();f=f.replace("\\","/");var g=a("#base_url").val(),h=a("#return_relative_url").val(),i=encodeURL((1==h?e:g+e)+b);if(""!=c)if(1==a("#crossdomain").val())d.postMessage({sender:"responsivefilemanager",url:i,field_id:c},"*");else{var j=a("#"+c,d.document);j.val(i).trigger("change"),"function"==typeof d.responsive_filemanager_callback&&d.responsive_filemanager_callback(c),s()}else apply_any(i)},apply_none=function(b){var c=a("ul.grid").find('li[data-name="'+b+'"] figcaption a');c[1].click(),a(".tip-right").tooltip("hide")},apply_any=function(b){if(1==a("#crossdomain").val())window.parent.postMessage({sender:"responsivefilemanager",url:b,field_id:null},"*");else{var c=a("#editor").val();if("ckeditor"==c){var d=r("CKEditorFuncNum");window.opener.CKEDITOR.tools.callFunction(d,b),window.close()}else parent.tinymce.majorVersion<4?(parent.tinymce.activeEditor.windowManager.params.setUrl(b),parent.tinymce.activeEditor.windowManager.close(parent.tinymce.activeEditor.windowManager.params.mce_window_id)):(parent.tinymce.activeEditor.windowManager.getParams().setUrl(b),parent.tinymce.activeEditor.windowManager.close())}},apply_file_duplicate=function(a,b){var c=a.parent().parent().parent().parent();c.after("<li class='"+c.attr("class")+"' data-name='"+c.attr("data-name")+"'>"+c.html()+"</li>");var d=c.next();apply_file_rename(d.find("figure"),b);var e=d.find(".download-form"),f="form"+(new Date).getTime();e.attr("id",f),e.find(".tip-right").attr("onclick","$('#"+f+"').submit();")},apply_file_rename=function(b,c){var d;b.attr("data-name",c),b.parent().attr("data-name",c),b.find("h4").find("a").text(c);var e=b.find("a.link");d=e.attr("data-file");var f=d.substring(d.lastIndexOf("/")+1),g=d.substring(d.lastIndexOf(".")+1);e.each(function(){a(this).attr("data-file",encodeURIComponent(c+"."+g))}),b.find("img").each(function(){var b=a(this).attr("src");a(this).attr("src",b.replace(f,c+"."+g)+"?time="+(new Date).getTime()),a(this).attr("alt",c+" thumbnails")});var h=b.find("a.preview");d=h.attr("data-url"),"undefined"!=typeof d&&d&&h.attr("data-url",d.replace(encodeURIComponent(f),encodeURIComponent(c+"."+g))),b.parent().attr("data-name",c+"."+g),b.attr("data-name",c+"."+g),b.find(".name_download").val(c+"."+g);var i=b.find("a.rename-file"),j=b.find("a.delete-file"),k=i.attr("data-path"),l=k.replace(f,c+"."+g);i.attr("data-path",l),j.attr("data-path",l)},apply_folder_rename=function(b,c){b.attr("data-name",c),b.find("figure").attr("data-name",c);var d=b.find("h4").find("a").text();b.find("h4 > a").text(c);var e=b.find(".folder-link"),f=e.attr("href"),g=a("#fldr_value").val(),h=f.replace("fldr="+g+encodeURIComponent(d),"fldr="+g+encodeURIComponent(c));e.each(function(){a(this).attr("href",h)});var i=b.find("a.delete-folder"),j=b.find("a.rename-folder"),k=j.attr("data-path"),l=k.lastIndexOf("/"),m=k.substr(0,l+1)+c;i.attr("data-path",m),j.attr("data-path",m)},show_animation=function(){a("#loading_container").css("display","block"),a("#loading").css("opacity",".7")},hide_animation=function(){a("#loading_container").fadeOut()}}(jQuery,Modernizr,image_editor);